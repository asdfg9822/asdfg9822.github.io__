<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="manap-playbox">
    <template>
        <style>

            app-toolbar {
                position: fixed;
                bottom: 0;
                right: 0;
                width: 100%;
                height: 50px;
                background-color: #ffffff;
                border-top: 1px solid rgba(0,0,0,.15);
            }

            .playbox-icon[pconly] {
                margin-left : 28px;
            }

            :host([hidden]), [hidden] {
                display: none !important;
            }

/*            .cover {
                width: 30px;
                height: 30px;
                margin-left: 11px;
                background: url("/data/music/dream/tikkit.jpg") no-repeat 30px 30px;
            }*/

            #cover {
                margin-left: 6px;
            }

            #cover img {
                margin-top: 6px;
                width: 33px;
                height: 33px;
                border: 1px solid #eaeaea;
            }

            .music-info {
                vertical-align: middle;
                margin-left: 11px;
                line-height: 14px;
                text-align: left;
            }

            .title {
                font-size: 16px;
                margin: 0px;
                padding: 0px;
                line-height: 20px;
            }

            .album {
                color:#999;
                font-size: 12px;
                font-weight: 300;
            }

            @media (max-width: 767px) {

                app-toolbar {
                    /*@apply(--layout-fixed-bottom);*/
                    background-color: #ffffff;
                    height: 50px;
                    z-index: 10;
                }

                paper-icon-button[pconly] {
                    display: none;
                }

                .playbox-icon {
                    margin-left : 28px;
                }
            }

        </style>

        <app-toolbar>
            <paper-icon-button icon="av:skip-previous" class="playbox-icon" on-tap="_prevMusic" pconly></paper-icon-button >
            <paper-icon-button icon="av:play-arrow" class="playbox-icon" on-tap="_playPause" hidden$="{{!playing}}" ></paper-icon-button>
            <paper-icon-button icon="av:pause" class="playbox-icon" on-tap="_playPause" hidden$="{{playing}}" ></paper-icon-button>
            <paper-icon-button icon="av:skip-next" on-tap="_nextMusic" pconly></paper-icon-button>
            <div id="cover" style=""><img src="{{playingMusic.coverImage}}"/></div>
            <div class="music-info">
                <div class="title">{{playingMusic.title}}</div>
                <div class="album">{{playingMusic.album}}</div>
            </div>
            <audio id="audio" src="{{playingMusic.music}}"></audio>
            <paper-icon-button icon="search"></paper-icon-button>
        </app-toolbar>
    </template>

    <script>

        Polymer({

            is: 'manap-playbox',

            behaviors: [
            ],

            attributeChanged: function (name) {
                if (name === 'hidden') {
                    console.log("ok");
                }
            },

            properties: {
                playing: {
                    type: Boolean,
                    notify: true,
                    value: true
                },

                musicList: Array,

                playingMusic: {
                    type: Object,
                    value: {
                        "album":"Dream",
                        "title":"Dream",
                        "singer":"Tikkit",
                        "coverImage":"/data/music/dream/tikkit.jpg",
                        "music":"/data/music/dream/example.mp3",
                        "index": 1
                    }
                }
            },

            animate: function() {
                this.playAnimation();
            },

            _playPause: function(e) {
                e.preventDefault();

                var player = this;
                player._togglePlay();

                if ( player.$.audio.paused ) {
                    player.$.audio.play();
                } else {
                    player.$.audio.pause();
                }
            },

            _togglePlay: function() {
                this.playing = !this.playing;
            },

            ready: function() {
                this._syncMusic();
            },

            _syncMusic: function() {
                //this.$.cover.style.backgroundImage = this.playingMusic.coverImage;
            },

            _prevMusic: function() {
                if(this.playingMusic.index > 0) {
                    this.playingMusic = musicList[this.playingMusic.index-1];
                    this.player.$.audio.play();
                } else {
                    this.player.$.audio.play();
                }
            },

            _nextMusic: function() {
                if(this.musicList.length > this.playingMusic.index) {
                    this.playingMusic = musicList[this.playingMusic.index+1];
                    this.player.$.audio.play();
                } else {
                    this.playingMusic = musicList[0];
                    this.player.$.audio.play();
                }
            }
        });
    </script>
</dom-module>